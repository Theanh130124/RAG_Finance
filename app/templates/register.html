{% extends "layout/base_login.html" %}

{% block title %}Đăng Ký - Hệ Thống Tư Vấn Tài Chính{% endblock %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/register.css') }}">
{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <!-- Header -->
        <div class="auth-header">
            <a href="{{ url_for('login') }}" class="btn btn-login">
                <i class="fas fa-sign-in-alt me-2"></i> Đăng nhập
            </a>
            <div class="auth-title-group">
                <h1 class="auth-title">ĐĂNG KÝ</h1>
                <p class="auth-subtitle">Tham gia hệ thống tư vấn tài chính thông minh</p>
            </div>
        </div>

        <!-- Form -->
        <form method="post" action="/register" class="auth-form" id="registerForm">
            {{ form.csrf_token }}

            <div class="form-grid">
                <!-- Row 1: Username và Email -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user me-2"></i>Tên đăng nhập *
                        </label>
                        {{ form.username(class="form-control", placeholder="Nhập tên đăng nhập", required=true) }}
                        {% for error in form.username.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                        <div class="form-hint">Từ 3-20 ký tự, chỉ bao gồm chữ cái, số và dấu gạch dưới</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-envelope me-2"></i>Email *
                        </label>
                        {{ form.email(class="form-control", placeholder="Nhập email", type="email", required=true) }}
                        {% for error in form.email.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Row 2: Password và Confirm Password -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock me-2"></i>Mật khẩu *
                        </label>
                        <div class="password-input-group">
                            {{ form.password(class="form-control", placeholder="Nhập mật khẩu", id="password", required=true) }}
                            <button type="button" class="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        {% for error in form.password.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                        <div class="password-strength">
                            <div class="strength-bar">
                                <div class="strength-fill" id="strength-fill"></div>
                            </div>
                            <span class="strength-text" id="strength-text">Độ mạnh mật khẩu</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-lock me-2"></i>Xác nhận mật khẩu *
                        </label>
                        <div class="password-input-group">
                            {{ form.confirm_password(class="form-control", placeholder="Nhập lại mật khẩu", id="confirm_password", required=true) }}
                            <button type="button" class="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        {% for error in form.confirm_password.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                        <div class="form-hint" id="password-match"></div>
                    </div>
                </div>

                <!-- Row 3: First name và Last name -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-signature me-2"></i>Họ *
                        </label>
                        {{ form.first_name(class="form-control", placeholder="Nhập họ", required=true) }}
                        {% for error in form.first_name.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-signature me-2"></i>Tên *
                        </label>
                        {{ form.last_name(class="form-control", placeholder="Nhập tên", required=true) }}
                        {% for error in form.last_name.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Row 4: Phone number -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-phone me-2"></i>Số điện thoại *
                        </label>
                        {{ form.phone_number(class="form-control", placeholder="Nhập số điện thoại", required=true) }}
                        {% for error in form.phone_number.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-briefcase me-2"></i>Nghề nghiệp
                        </label>
                        {{ form.occupation(class="form-control", placeholder="Nhập nghề nghiệp") }}
                        {% for error in form.occupation.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Row 5: Monthly Income và Financial Goals -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-money-bill-wave me-2"></i>Thu nhập hàng tháng (VNĐ)
                        </label>
                        {{ form.monthly_income(class="form-control", placeholder="Nhập thu nhập") }}
                        {% for error in form.monthly_income.errors %}
                            <div class="form-error">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Terms and Conditions -->
            <div class="form-group">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                    <label class="form-check-label" for="agreeTerms">
                        Tôi đồng ý với
                        <a href="#" class="terms-link">Điều khoản dịch vụ</a> và
                        <a href="#" class="terms-link">Chính sách bảo mật</a> *
                    </label>
                </div>
            </div>

            <!-- Error Message -->
            {% if mse %}
            <div class="alert alert-danger auth-alert" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>{{ mse }}
            </div>
            {% endif %}

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary btn-auth w-100">
                <i class="fas fa-user-plus me-2"></i>
                Tạo tài khoản
            </button>
        </form>

        <!-- Footer -->
        <div class="auth-footer">
            <p class="footer-text">
                Đã có tài khoản?
                <a href="{{ url_for('login') }}" class="auth-link">Đăng nhập ngay</a>
            </p>
            <div class="support-info">
                <p><i class="fas fa-info-circle me-2"></i>Chuyên gia tài chính cần tài khoản? Vui lòng liên hệ quản trị viên</p>
            </div>
        </div>
    </div>

    <!-- Benefits Section -->
    <div class="benefits-section">
        <div class="benefits-content">
            <h2>Lợi ích khi tham gia</h2>
            <div class="benefits-list">
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3>Chatbot AI Thông Minh</h3>
                    <p>Nhận tư vấn tài chính 24/7 từ chatbot được đào tạo chuyên sâu</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Chuyên Gia Tài Chính</h3>
                    <p>Kết nối trực tiếp với các chuyên gia tài chính giàu kinh nghiệm</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <h3>Quản Lý Chi Tiêu</h3>
                    <p>Theo dõi và quản lý chi tiêu hiệu quả với công cụ thông minh</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h3>Kế Hoạch Tài Chính</h3>
                    <p>Xây dựng kế hoạch tài chính cá nhân phù hợp với mục tiêu của bạn</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password visibility toggle
    const toggleButtons = document.querySelectorAll('.toggle-password');
    toggleButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const input = this.closest('.password-input-group').querySelector('input');
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        });
    });

    // Password strength checker
    const passwordInput = document.getElementById('password');
    const strengthFill = document.getElementById('strength-fill');
    const strengthText = document.getElementById('strength-text');

    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            const strength = calculatePasswordStrength(password);

            strengthFill.style.width = strength.percentage + '%';
            strengthFill.className = 'strength-fill ' + strength.class;
            strengthText.textContent = strength.text;
            strengthText.className = 'strength-text ' + strength.class;
        });
    }

    // Password match checker
    const confirmInput = document.getElementById('confirm_password');
    const matchHint = document.getElementById('password-match');

    if (confirmInput) {
        confirmInput.addEventListener('input', function() {
            const password = passwordInput.value;
            const confirm = this.value;

            if (confirm === '') {
                matchHint.textContent = '';
                matchHint.className = 'form-hint';
            } else if (password === confirm) {
                matchHint.textContent = '✓ Mật khẩu khớp';
                matchHint.className = 'form-hint text-success';
            } else {
                matchHint.textContent = '✗ Mật khẩu không khớp';
                matchHint.className = 'form-hint text-danger';
            }
        });
    }

    // Format monthly income
    const incomeInput = document.querySelector('[name="monthly_income"]');
    if (incomeInput) {
        incomeInput.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value) {
                value = parseInt(value).toLocaleString('vi-VN');
                this.value = value;
            }
        });
    }

    function calculatePasswordStrength(password) {
        let score = 0;
        let feedback = {
            class: 'weak',
            text: 'Rất yếu',
            percentage: 0
        };

        if (!password) return feedback;

        // Length check
        if (password.length >= 8) score++;
        if (password.length >= 12) score++;

        // Character variety
        if (/[a-z]/.test(password)) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^a-zA-Z0-9]/.test(password)) score++;

        // Determine strength
        if (score >= 6) {
            feedback = { class: 'strong', text: 'Mạnh', percentage: 100 };
        } else if (score >= 4) {
            feedback = { class: 'medium', text: 'Trung bình', percentage: 66 };
        } else if (score >= 2) {
            feedback = { class: 'weak', text: 'Yếu', percentage: 33 };
        } else {
            feedback = { class: 'very-weak', text: 'Rất yếu', percentage: 10 };
        }

        return feedback;
    }

    // Form validation
    const form = document.getElementById('registerForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            const password = passwordInput.value;
            const confirm = confirmInput.value;

            if (password !== confirm) {
                e.preventDefault();
                matchHint.textContent = '✗ Vui lòng xác nhận mật khẩu chính xác';
                matchHint.className = 'form-hint text-danger';
                confirmInput.focus();
            }
        });
    }
});
</script>
{% endblock %}